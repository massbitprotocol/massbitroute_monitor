{
  "version": 4,
  "terraform_version": "1.1.7",
  "serial": 15,
  "lineage": "e7914a33-b514-450d-d458-34629f2157e9",
  "outputs": {
    "mbr_core_public_ip": {
      "value": "34.101.146.131",
      "type": "string"
    },
    "mbr_portal_public_ip": {
      "value": "34.101.57.212",
      "type": "string"
    },
    "mbr_rust_public_ip": {
      "value": "34.101.193.8",
      "type": "string"
    }
  },
  "resources": [
    {
      "mode": "managed",
      "type": "google_compute_instance",
      "name": "mbr-portal-new-commit-test",
      "provider": "provider[\"registry.terraform.io/hashicorp/google-beta\"]",
      "instances": [
        {
          "schema_version": 6,
          "attributes": {
            "advanced_machine_features": [],
            "allow_stopping_for_update": null,
            "attached_disk": [],
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "persistent-disk-0",
                "disk_encryption_key_raw": "",
                "disk_encryption_key_sha256": "",
                "initialize_params": [
                  {
                    "image": "https://www.googleapis.com/compute/beta/projects/ubuntu-os-cloud/global/images/ubuntu-2004-focal-v20210720",
                    "labels": {},
                    "size": 20,
                    "type": "pd-standard"
                  }
                ],
                "kms_key_self_link": "",
                "mode": "READ_WRITE",
                "source": "https://www.googleapis.com/compute/v1/projects/mbr-test-341307/zones/asia-southeast2-a/disks/mbr-test-portal-test-55147"
              }
            ],
            "can_ip_forward": false,
            "confidential_instance_config": [],
            "cpu_platform": "Intel Broadwell",
            "current_status": "RUNNING",
            "deletion_protection": false,
            "description": "",
            "desired_status": null,
            "enable_display": false,
            "guest_accelerator": [],
            "hostname": "",
            "id": "projects/mbr-test-341307/zones/asia-southeast2-a/instances/mbr-test-portal-test-55147",
            "instance_id": "3126016598655039910",
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": null,
            "machine_type": "e2-medium",
            "metadata": null,
            "metadata_fingerprint": "Tt8EpjEgjyU=",
            "metadata_startup_script": "  #!/bin/bash\n  #-------------------------------------------\n  #  Update host file for Massbitroute.dev\n  #-------------------------------------------\n  sudo echo \"curl https://raw.githubusercontent.com/hoanito/hosts/main/test-hosts-file \u003e /etc/hosts\" \u003e /opt/update_hosts.sh\n  sudo chmod 770 /opt/update_hosts.sh\n\n  sudo echo \"* * * * * root sudo bash /opt/update_hosts.sh\" \u003e\u003e /etc/crontab\n  sudo echo \"* * * * * sudo bash /opt/update_hosts.sh\" \u003e update_hosts.cron\n  sudo crontab update_hosts.cron\n  sudo service cron reload\n\n  sudo sed 's/#DNSStubListener=yes/DNSStubListener=no/' /etc/systemd/resolved.conf -i\n  sudo pkill -f systemd-resolve\n\n  sudo systemctl stop systemd-resolved\n  sudo systemctl disable systemd-resolved \n  sudo echo nameserver 8.8.8.8 \u003e/etc/resolv.conf\n\n  #-------------------------------------------\n  #  Install SSH keys\n  #-------------------------------------------\n  sudo mkdir /opt/ssh-key\n  sudo git clone http://ssh:1fdaf5d506fda56b4a50a5e3f24d68799e33cdd2@git.massbitroute.dev/massbitroute/ssh.git -b main /opt/ssh-key\n  sudo cp /opt/ssh-key/id_rsa*  /root/.ssh/\n  sudo chmod og-rwx /root/.ssh/id_rsa\n  sudo cat /opt/ssh-key/ci-ssh-key.pub \u003e\u003e /home/hoang/.ssh/authorized_keys\n  \n  ssh-keyscan github.com \u003e\u003e ~/.ssh/known_hosts\n  \n  #-------------------------------------------\n  #  Install massbitroute PORTAL components\n  #-------------------------------------------\n  export PRIVATE_GIT_DOMAIN='git.massbitroute.dev'\n  export PRIVATE_GIT_READ_PASSWORD='c671e4ea06280e7a3f6f9aea6e8155fcde9bc703'\n  export PRIVATE_GIT_READ_USERNAME='massbit'\n  export PRIVATE_GIT_SSL_USERNAME='ssl'\n  export PRIVATE_GIT_SSL_PASSWORD='77842e9d937e34029005ca9d90c6f1d09c39b09f'\n  export PRIVATE_GIT_SSH_USERNAME='ssh'\n  export PRIVATE_GIT_SSH_PASSWORD='1fdaf5d506fda56b4a50a5e3f24d68799e33cdd2'\n\n  #-------------------------------------------\n  #  Install packages\n  #-------------------------------------------\n  sudo apt update\n  sudo apt install redis-server npm -y\n  sudo systemctl enable redis-server\n  sudo npm install --global yarn\n  sudo npm cache clean -f\n  sudo npm install -g n\n  sudo n stable\n  sudo yarn global add pm2\n  \n  #-------------------------------------------\n  #  Install PORTAL API\n  #-------------------------------------------\n  sudo mkdir /opt/user-management\n  sudo git clone git@github.com:massbitprotocol/user-management.git -b staging /opt/user-management\n  cd /opt/user-management\n  cp .env.admin.sample .env.admin\n  cp .env.api.sample .env.api\n  cp .env.worker.sample .env.worker\n  sudo yarn\n  sudo yarn build\n  sudo pm2 start\n\n  #-------------------------------------------\n  #  Install STAKING API\n  #-------------------------------------------\n  sudo mkdir /opt/test-massbit-staking\n  sudo git clone git@github.com:mison201/test-massbit-staking.git  /opt/test-massbit-staking\n  cd /opt/test-massbit-staking\n  cp .env.sample .env\n  sudo yarn\n  sudo yarn build\n  sudo pm2 start\n\n  #-------------------------------------------\n  #  Install NGINX\n  #-------------------------------------------\n  sudo mkdir -p /opt/ssl\n  git clone http://$PRIVATE_GIT_SSL_USERNAME:$PRIVATE_GIT_SSL_PASSWORD@$PRIVATE_GIT_DOMAIN/massbitroute/ssl.git /etc/letsencrypt\n  sudo apt update \u0026\u0026 sudo apt upgrade -y \u0026\u0026 sudo apt install curl nginx -y\n  sudo apt install software-properties-common\n  cp /opt/ssh-key/portal.nginx /etc/nginx/sites-enabled/portal\n  cp /opt/ssh-key/staking.nginx /etc/nginx/sites-enabled/staking\n  sudo service nginx reload\n\n",
            "min_cpu_platform": "",
            "name": "mbr-test-portal-test-55147",
            "network_interface": [
              {
                "access_config": [
                  {
                    "nat_ip": "34.101.57.212",
                    "network_tier": "PREMIUM",
                    "public_ptr_domain_name": ""
                  }
                ],
                "alias_ip_range": [],
                "ipv6_access_config": [],
                "ipv6_access_type": "",
                "name": "nic0",
                "network": "https://www.googleapis.com/compute/v1/projects/mbr-test-341307/global/networks/default",
                "network_ip": "10.184.0.46",
                "nic_type": "",
                "queue_count": 0,
                "stack_type": "IPV4_ONLY",
                "subnetwork": "https://www.googleapis.com/compute/v1/projects/mbr-test-341307/regions/asia-southeast2/subnetworks/default",
                "subnetwork_project": "mbr-test-341307"
              }
            ],
            "network_performance_config": [],
            "project": "mbr-test-341307",
            "reservation_affinity": [],
            "resource_policies": null,
            "scheduling": [
              {
                "automatic_restart": true,
                "min_node_cpus": 0,
                "node_affinities": [],
                "on_host_maintenance": "MIGRATE",
                "preemptible": false,
                "provisioning_model": "STANDARD"
              }
            ],
            "scratch_disk": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/mbr-test-341307/zones/asia-southeast2-a/instances/mbr-test-portal-test-55147",
            "service_account": [
              {
                "email": "mbr-test@mbr-test-341307.iam.gserviceaccount.com",
                "scopes": [
                  "https://www.googleapis.com/auth/cloud-platform"
                ]
              }
            ],
            "shielded_instance_config": [
              {
                "enable_integrity_monitoring": true,
                "enable_secure_boot": false,
                "enable_vtpm": true
              }
            ],
            "tags": [
              "http-server",
              "https-server"
            ],
            "tags_fingerprint": "6smc4R4d39I=",
            "timeouts": null,
            "zone": "asia-southeast2-a"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiNiJ9"
        }
      ]
    },
    {
      "mode": "managed",
      "type": "google_compute_instance",
      "name": "mbr-rust-new-commit-test",
      "provider": "provider[\"registry.terraform.io/hashicorp/google-beta\"]",
      "instances": [
        {
          "schema_version": 6,
          "attributes": {
            "advanced_machine_features": [],
            "allow_stopping_for_update": null,
            "attached_disk": [],
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "persistent-disk-0",
                "disk_encryption_key_raw": "",
                "disk_encryption_key_sha256": "",
                "initialize_params": [
                  {
                    "image": "https://www.googleapis.com/compute/beta/projects/ubuntu-os-cloud/global/images/ubuntu-2004-focal-v20210720",
                    "labels": {},
                    "size": 20,
                    "type": "pd-standard"
                  }
                ],
                "kms_key_self_link": "",
                "mode": "READ_WRITE",
                "source": "https://www.googleapis.com/compute/v1/projects/mbr-test-341307/zones/asia-southeast2-a/disks/mbr-test-rust-test-55147"
              }
            ],
            "can_ip_forward": false,
            "confidential_instance_config": [],
            "cpu_platform": "Intel Broadwell",
            "current_status": "RUNNING",
            "deletion_protection": false,
            "description": "",
            "desired_status": null,
            "enable_display": false,
            "guest_accelerator": [],
            "hostname": "",
            "id": "projects/mbr-test-341307/zones/asia-southeast2-a/instances/mbr-test-rust-test-55147",
            "instance_id": "2766872322421750182",
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": null,
            "machine_type": "e2-medium",
            "metadata": null,
            "metadata_fingerprint": "po6VVQJJolI=",
            "metadata_startup_script": "  #!/bin/bash\n  #-------------------------------------------\n  #  Update host file for Massbitroute.dev\n  #-------------------------------------------\n  sudo echo \"curl https://raw.githubusercontent.com/hoanito/hosts/main/test-hosts-file \u003e /etc/hosts\" \u003e\u003e /opt/update_hosts.sh\n  sudo chmod 770 /opt/update_hosts.sh\n\n  sudo echo \"* * * * * root sudo bash /opt/update_hosts.sh\" \u003e\u003e /etc/crontab\n  sudo echo \"* * * * * sudo bash /opt/update_hosts.sh\" \u003e update_hosts.cron\n  sudo crontab update_hosts.cron\n  sudo service cron reload\n\n  sudo sed 's/#DNSStubListener=yes/DNSStubListener=no/' /etc/systemd/resolved.conf -i\n  sudo pkill -f systemd-resolve\n  sudo systemctl stop systemd-resolved\n  sudo systemctl disable systemd-resolved \n  sudo echo nameserver 8.8.8.8 \u003e/etc/resolv.conf\n  \n  #-------------------------------------------\n  #  Install SSH keys\n  #-------------------------------------------\n  sudo mkdir /opt/ssh-key\n  sudo git clone http://ssh:1fdaf5d506fda56b4a50a5e3f24d68799e33cdd2@git.massbitroute.dev/massbitroute/ssh.git -b main /opt/ssh-key\n  sudo cp /opt/ssh-key/id_rsa*  /root/.ssh/\n  sudo chmod og-rwx /root/.ssh/id_rsa\n  sudo cat /opt/ssh-key/ci-ssh-key.pub \u003e\u003e /home/hoang/.ssh/authorized_keys\n  \n  ssh-keyscan github.com \u003e\u003e ~/.ssh/known_hosts\n\n  #-------------------------------------------\n  #  Install RUST\n  #-------------------------------------------\n  sudo apt update -y\n  curl https://sh.rustup.rs -sSf | sh -s -- -y\n  rustup update nightly\n  rustup update stable\n  rustup target add wasm32-unknown-unknown --toolchain nightly\n  sudo apt install build-essential pkg-config libssl-dev supervisor -y\n\n  #-------------------------------------------\n  #  Set up supervisor\n  #-------------------------------------------\n  echo \"[program:verification]\ncommand=bash /opt/verification/run.sh\nautostart=true\nautorestart=true\nstderr_logfile=/var/log/verification.err.log\nstdout_logfile=/var/log/verification.out.log\nuser=root\nstopasgroup=true\" \u003e /etc/supervisor/conf.d/verification.conf\n\n  #-------------------------------------------\n  #  Install NGINX\n  #-------------------------------------------\n  sudo apt install curl nginx -y\n  sudo apt install software-properties-common\n  sudo curl https://raw.githubusercontent.com/hoanito/hosts/main/verification.nginx \u003e /etc/nginx/sites-enabled/verification\n\n  sudo service nginx restart\n\n  #-------------------------------------------\n  #  Install VERIFICATION (RUST)\n  #-------------------------------------------\n  sudo mkdir -p /massbit/massbitroute/app/src/sites/services/monitor\n  sudo git clone https://github.com/massbitprotocol/massbitroute_monitor.git -b dev /massbit/massbitroute/app/src/sites/services/monitor\n  cd /massbit/massbitroute/app/src/sites/services/monitor/check_component\n  /root/.cargo/bin/cargo build --release\n  mkdir -p /opt/verification\n  sudo cp target/release/mbr-check-component /opt/verification/mbr-check-component\n  sudo cp src/archive/check-flow.json /opt/verification/check-flow.json\n  sudo cp /opt/ssh-key/base-endpoint.json  /opt/verification/base-endpoint.json\n  sudo cp script/run.sh /opt/verification/run.sh\n  sudo cp config_check_component_test.json /opt/verification/config_check_component.json\n  \n  sudo chmod 770 /opt/verification/run.sh\n  sudo supervisorctl reread\n  sudo  supervisorctl update\n  sudo supervisorctl start verification\n",
            "min_cpu_platform": "",
            "name": "mbr-test-rust-test-55147",
            "network_interface": [
              {
                "access_config": [
                  {
                    "nat_ip": "34.101.193.8",
                    "network_tier": "PREMIUM",
                    "public_ptr_domain_name": ""
                  }
                ],
                "alias_ip_range": [],
                "ipv6_access_config": [],
                "ipv6_access_type": "",
                "name": "nic0",
                "network": "https://www.googleapis.com/compute/v1/projects/mbr-test-341307/global/networks/default",
                "network_ip": "10.184.0.13",
                "nic_type": "",
                "queue_count": 0,
                "stack_type": "IPV4_ONLY",
                "subnetwork": "https://www.googleapis.com/compute/v1/projects/mbr-test-341307/regions/asia-southeast2/subnetworks/default",
                "subnetwork_project": "mbr-test-341307"
              }
            ],
            "network_performance_config": [],
            "project": "mbr-test-341307",
            "reservation_affinity": [],
            "resource_policies": null,
            "scheduling": [
              {
                "automatic_restart": true,
                "min_node_cpus": 0,
                "node_affinities": [],
                "on_host_maintenance": "MIGRATE",
                "preemptible": false,
                "provisioning_model": "STANDARD"
              }
            ],
            "scratch_disk": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/mbr-test-341307/zones/asia-southeast2-a/instances/mbr-test-rust-test-55147",
            "service_account": [
              {
                "email": "mbr-test@mbr-test-341307.iam.gserviceaccount.com",
                "scopes": [
                  "https://www.googleapis.com/auth/cloud-platform"
                ]
              }
            ],
            "shielded_instance_config": [
              {
                "enable_integrity_monitoring": true,
                "enable_secure_boot": false,
                "enable_vtpm": true
              }
            ],
            "tags": [
              "http-server",
              "https-server"
            ],
            "tags_fingerprint": "6smc4R4d39I=",
            "timeouts": null,
            "zone": "asia-southeast2-a"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiNiJ9"
        }
      ]
    },
    {
      "mode": "managed",
      "type": "google_compute_instance_from_machine_image",
      "name": "mbr-core-new-commit-test",
      "provider": "provider[\"registry.terraform.io/hashicorp/google-beta\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "advanced_machine_features": [],
            "allow_stopping_for_update": null,
            "attached_disk": [],
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "mbr-test-core",
                "disk_encryption_key_raw": "",
                "disk_encryption_key_sha256": "",
                "initialize_params": [
                  {
                    "image": "",
                    "labels": {},
                    "size": 10,
                    "type": "pd-balanced"
                  }
                ],
                "kms_key_self_link": "",
                "mode": "READ_WRITE",
                "source": "https://www.googleapis.com/compute/v1/projects/mbr-test-341307/zones/asia-southeast2-a/disks/mbr-test-core-test-55147"
              }
            ],
            "can_ip_forward": false,
            "confidential_instance_config": [
              {
                "enable_confidential_compute": false
              }
            ],
            "cpu_platform": "Intel Broadwell",
            "current_status": "RUNNING",
            "deletion_protection": false,
            "description": "",
            "desired_status": null,
            "enable_display": false,
            "guest_accelerator": [],
            "hostname": "",
            "id": "projects/mbr-test-341307/zones/asia-southeast2-a/instances/mbr-test-core-test-55147",
            "instance_id": "1995240834484599206",
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": {},
            "machine_type": "e2-medium",
            "metadata": {},
            "metadata_fingerprint": "XTSuK2gyteg=",
            "metadata_startup_script": "  #!/bin/bash\n  #-------------------------------------------\n  #  Update host file for Massbitroute.dev\n  #-------------------------------------------\n  sudo sed 's/#DNSStubListener=yes/DNSStubListener=no/' /etc/systemd/resolved.conf -i\n  sudo pkill -f systemd-resolve\n  sudo systemctl stop systemd-resolved\n  sudo systemctl disable systemd-resolved \n  sudo echo nameserver 8.8.8.8 \u003e/etc/resolv.conf\n  \n  sudo echo \"curl https://raw.githubusercontent.com/hoanito/hosts/main/test-hosts-file \u003e /etc/hosts\" \u003e\u003e /opt/update_hosts.sh\n  sudo chmod 770 /opt/update_hosts.sh\n\n  sudo echo \"* * * * * root sudo bash /opt/update_hosts.sh\" \u003e\u003e /etc/crontab\n  sudo echo \"* * * * * sudo bash /opt/update_hosts.sh\" \u003e update_hosts.cron\n  sudo crontab update_hosts.cron\n  sudo service cron reload\n  #-------------------------------------------\n  #  Install massbitroute core components\n  #-------------------------------------------\n  sleep 30\n  export API_BRANCH=dev\n  export GIT_PRIVATE_READ_URL=\"http://massbit:c671e4ea06280e7a3f6f9aea6e8155fcde9bc703@git.massbitroute.dev\"\n  git -C /massbit/massbitroute/app/src pull\n  cd /massbit/massbitroute/app/src/scripts\n  bash run _refresh \u003e\u003e /home/refresh.log\n",
            "min_cpu_platform": "",
            "name": "mbr-test-core-test-55147",
            "network_interface": [
              {
                "access_config": [
                  {
                    "nat_ip": "34.101.146.131",
                    "network_tier": "PREMIUM",
                    "public_ptr_domain_name": ""
                  }
                ],
                "alias_ip_range": [],
                "ipv6_access_config": [],
                "ipv6_access_type": "",
                "name": "nic0",
                "network": "https://www.googleapis.com/compute/v1/projects/mbr-test-341307/global/networks/default",
                "network_ip": "10.184.0.49",
                "nic_type": "",
                "queue_count": 0,
                "stack_type": "IPV4_ONLY",
                "subnetwork": "https://www.googleapis.com/compute/v1/projects/mbr-test-341307/regions/asia-southeast2/subnetworks/default",
                "subnetwork_project": "mbr-test-341307"
              }
            ],
            "network_performance_config": [],
            "project": "mbr-test-341307",
            "reservation_affinity": [
              {
                "specific_reservation": [],
                "type": "ANY_RESERVATION"
              }
            ],
            "resource_policies": [],
            "scheduling": [
              {
                "automatic_restart": true,
                "min_node_cpus": 0,
                "node_affinities": [],
                "on_host_maintenance": "MIGRATE",
                "preemptible": false,
                "provisioning_model": "STANDARD"
              }
            ],
            "scratch_disk": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/mbr-test-341307/zones/asia-southeast2-a/instances/mbr-test-core-test-55147",
            "service_account": [
              {
                "email": "mbr-test@mbr-test-341307.iam.gserviceaccount.com",
                "scopes": [
                  "https://www.googleapis.com/auth/cloud-platform"
                ]
              }
            ],
            "shielded_instance_config": [
              {
                "enable_integrity_monitoring": true,
                "enable_secure_boot": false,
                "enable_vtpm": true
              }
            ],
            "source_machine_image": "projects/mbr-test-341307/global/machineImages/mbr-test-core",
            "tags": [
              "http-server",
              "https-server"
            ],
            "tags_fingerprint": "6smc4R4d39I=",
            "timeouts": null,
            "zone": "asia-southeast2-a"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19"
        }
      ]
    }
  ]
}
